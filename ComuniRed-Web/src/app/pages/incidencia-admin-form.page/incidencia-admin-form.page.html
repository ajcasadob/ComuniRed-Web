<div class="container py-4">
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">{{ isEditMode ? 'Editar' : 'Nueva' }} Incidencia</h2>
        <button type="button" class="btn btn-outline-secondary rounded-pill" (click)="cancelar()">
          <i class="bi bi-arrow-left me-2"></i>Volver
        </button>
      </div>

      <form [formGroup]="incidenciaForm" (ngSubmit)="guardarIncidencia()">
        <!-- Título -->
        <div class="mb-3">
          <label for="titulo" class="form-label">Título *</label>
          <input
            type="text"
            id="titulo"
            class="form-control"
            formControlName="titulo"
            placeholder="Ej: Luz fundida en pasillo 3"
          />
          @if (incidenciaForm.get('titulo')?.invalid && incidenciaForm.get('titulo')?.touched) {
            <div class="text-danger small mt-1">
              @if (incidenciaForm.get('titulo')?.errors?.['required']) {
                El título es obligatorio
              }
              @if (incidenciaForm.get('titulo')?.errors?.['maxlength']) {
                Máximo 200 caracteres
              }
            </div>
          }
        </div>

        <!-- Descripción -->
        <div class="mb-3">
          <label for="descripcion" class="form-label">Descripción *</label>
          <textarea
            id="descripcion"
            class="form-control"
            formControlName="descripcion"
            rows="4"
            placeholder="Describe el problema detalladamente"
          ></textarea>
          @if (incidenciaForm.get('descripcion')?.invalid && incidenciaForm.get('descripcion')?.touched) {
            <div class="text-danger small mt-1">
              La descripción es obligatoria
            </div>
          }
        </div>

        <!-- Categoría -->
        <div class="mb-3">
          <label for="categoria" class="form-label">Categoría *</label>
          <select id="categoria" class="form-select" formControlName="categoria">
            <option value="">Selecciona una categoría</option>
            @for (cat of categorias; track cat) {
              <option [value]="cat">{{ cat }}</option>
            }
          </select>
          @if (incidenciaForm.get('categoria')?.invalid && incidenciaForm.get('categoria')?.touched) {
            <div class="text-danger small mt-1">
              La categoría es obligatoria
            </div>
          }
        </div>

        <!-- Ubicación -->
        <div class="mb-3">
          <label for="ubicacion" class="form-label">Ubicación *</label>
          <input
            type="text"
            id="ubicacion"
            class="form-control"
            formControlName="ubicacion"
            placeholder="Ej: Pasillo 3, Garaje, Entrada principal"
          />
          @if (incidenciaForm.get('ubicacion')?.invalid && incidenciaForm.get('ubicacion')?.touched) {
            <div class="text-danger small mt-1">
              @if (incidenciaForm.get('ubicacion')?.errors?.['required']) {
                La ubicación es obligatoria
              }
              @if (incidenciaForm.get('ubicacion')?.errors?.['maxlength']) {
                Máximo 255 caracteres
              }
            </div>
          }
        </div>

        <!-- Estado (solo en modo edición) -->
        @if (isEditMode) {
          <div class="mb-3">
            <label for="estado" class="form-label">Estado *</label>
            <select id="estado" class="form-select" formControlName="estado">
              @for (estado of estados; track estado) {
                <option [value]="estado">{{ estado }}</option>
              }
            </select>
          </div>

          <!-- Fecha de Resolución (solo si está resuelta) -->
          @if (incidenciaForm.get('estado')?.value === 'Resuelta') {
            <div class="mb-3">
              <label for="fecha_resolucion" class="form-label">Fecha de Resolución *</label>
              <input
                type="date"
                id="fecha_resolucion"
                class="form-control"
                formControlName="fecha_resolucion"
              />
            </div>
          }
        }

        <!-- Vivienda -->
        <div class="mb-3">
          <label for="vivienda_id" class="form-label">Vivienda</label>
          <input
            type="number"
            id="vivienda_id"
            class="form-control"
            formControlName="vivienda_id"
            placeholder="ID de la vivienda (opcional)"
          />
          <small class="text-muted">Opcional: Indica la vivienda relacionada si aplica</small>
        </div>

        <!-- Botones -->
        <div class="d-flex gap-2">
          <button
            type="submit"
            class="btn btn-primary rounded-pill"
            [disabled]="!incidenciaForm.valid"
          >
            <i class="bi bi-check-circle me-2"></i>
            {{ isEditMode ? 'Actualizar' : 'Crear' }} Incidencia
          </button>
          <button type="button" class="btn btn-outline-secondary rounded-pill" (click)="cancelar()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
